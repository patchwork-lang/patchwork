# Session Checkpoint - 2025-12-05

## Features Implemented

### 1. Print Output Routing to ACP
- Added `PrintSink` channel type to `Runtime` for redirecting print output
- `print()` builtin sends through channel instead of stdout
- ACP proxy forwards prints as `SessionNotification::AgentMessageChunk`
- Streaming: each print sends immediately to client

**Files changed:**
- `crates/patchwork-eval/src/runtime.rs` - PrintSink type, print() method
- `crates/patchwork-eval/src/interpreter.rs` - set_print_sink() method
- `crates/patchwork-eval/src/eval.rs` - print builtin uses runtime.print()
- `crates/patchwork-eval/src/lib.rs` - export PrintSink
- `crates/patchwork-acp/src/main.rs` - channel setup, forward_prints_to_notifications()

### 2. Escape Sequence Processing
- Added `process_escape_sequences()` function in eval.rs
- Supports: `\n`, `\t`, `\r`, `\\`, `\"`, `\'`, `\$`, `\0`
- Unknown escapes preserved as-is
- Added tests for escape handling

### 3. Shell Shorthand
- Messages starting with `$` are now treated as shell commands
- `$ ls -la` expands to:
  ```patchwork
  {
    var output = ($ ls -la)
    print("```\n${output}```\n")
  }
  ```
- Quick way to run commands without full block syntax

### Known Issue
- Lexer bug: trailing `\\` before closing `"` breaks parsing (e.g., `"foo\\"`)
- The `\\` escapes the quote, making string unterminated
- Workaround: don't end strings with `\\`

## Test Results
All 127 tests pass (124 original + 3 new escape tests)